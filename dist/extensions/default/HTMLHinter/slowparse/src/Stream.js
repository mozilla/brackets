module.exports=function(){"use strict";var ParseError=require("./ParseError");var ParseErrorBuilders=require("./ParseErrorBuilders");function Stream(text){this.text=text;this.pos=0;this.tokenStart=0}Stream.prototype={peek:function(){return this.text[this.pos]},substream:function(len){return this.text.substring(this.pos,this.pos+len)},next:function(){if(!this.end())return this.text[this.pos++]},rewind:function(x){this.pos-=x;if(this.pos<0){this.pos=0}},end:function(){return this.pos==this.text.length},eat:function(match){if(!this.end()&&this.peek().match(match))return this.next()},eatWhile:function(matcher){var wereAnyEaten=false;while(!this.end()){if(this.eat(matcher))wereAnyEaten=true;else return wereAnyEaten}},eatSpace:function(){return this.eatWhile(/[\s\n]/)},eatCSSWhile:function(matcher){var wereAnyEaten=false,chr="",peek="",next="";while(!this.end()){chr=this.eat(matcher);if(chr)wereAnyEaten=true;else return wereAnyEaten;if(chr==="/"){peek=this.peek();if(peek==="*"){while(next!=="/"&&!this.end()){this.eatWhile(/[^*]/);this.next();next=this.next()}next=""}}}},findContentEnd:function(){var quoted=false,c,_c;while(!this.end()){c=this.next();if(c==='"'||c==="'"){if(quoted===false)quoted=c;else if(quoted===c&&_c!=="\\")quoted=false;continue}if(c===";"&&quoted===false){break}_c=c}this.pos--},stripCommentBlock:function(){if(this.substream(2)!=="/*")return;this.pos+=2;for(;!this.end();this.pos++){if(this.substream(2)==="*/"){this.pos+=2;break}}this.eatSpace()},markTokenStart:function(){this.tokenStart=this.pos},markTokenStartAfterSpace:function(){this.eatSpace();this.markTokenStart()},makeToken:function(){if(this.pos==this.tokenStart)return null;var token={value:this.text.slice(this.tokenStart,this.pos),interval:{start:this.tokenStart,end:this.pos}};this.tokenStart=this.pos;return token},match:function(string,consume,caseFold){var substring=this.text.slice(this.pos,this.pos+string.length);if(caseFold){string=string.toLowerCase();substring=substring.toLowerCase()}if(string==substring){if(consume)this.pos+=string.length;return true}return false},findNext:function(pattern,groupNumber){var currentPos=this.pos;this.eatWhile(/[^>]/);this.next();var nextPos=this.pos;this.pos=currentPos;var token=this.substream(nextPos-currentPos);var captureGroups=token.match(pattern);this.pos=currentPos;if(captureGroups){return captureGroups[groupNumber]}return false}};return Stream}();