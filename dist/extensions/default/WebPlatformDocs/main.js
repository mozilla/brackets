define(function(require,exports,module){"use strict";var EditorManager=brackets.getModule("editor/EditorManager"),FileSystem=brackets.getModule("filesystem/FileSystem"),FileUtils=brackets.getModule("file/FileUtils"),ExtensionUtils=brackets.getModule("utils/ExtensionUtils"),CSSUtils=brackets.getModule("language/CSSUtils");var InlineDocsViewer=require("InlineDocsViewer");var _cssDocsPromise=null;function getCSSDocs(){if(!_cssDocsPromise){var result=new $.Deferred;var path=ExtensionUtils.getModulePath(module,"css.json"),file=FileSystem.getFileForPath(path);FileUtils.readAsText(file).done(function(text){var jsonData;try{jsonData=JSON.parse(text)}catch(ex){console.error("Malformed CSS documentation database: ",ex);result.reject()}result.resolve(jsonData)}).fail(function(err){console.error("Unable to load CSS documentation database: ",err);result.reject()});_cssDocsPromise=result.promise()}return _cssDocsPromise}function inlineProvider(hostEditor,pos){var langId=hostEditor.getLanguageForSelection().getId();if(langId!=="css"&&langId!=="scss"&&langId!=="less"){return null}var sel=hostEditor.getSelection();if(sel.start.line!==sel.end.line){return null}var cssInfo=CSSUtils.getInfoAtPos(hostEditor,sel.start);if(cssInfo&&cssInfo.name){var cssPropName=cssInfo.name,result=new $.Deferred;getCSSDocs().done(function(cssDocs){var cssPropDetails=cssDocs.PROPERTIES["css/properties/"+cssPropName];if(!cssPropDetails){cssPropName=cssPropName.replace(/^-(webkit|moz|ms|o)-/,"");if(cssPropName){cssPropDetails=cssDocs.PROPERTIES["css/properties/"+cssPropName]}}if(cssPropDetails){var inlineWidget=new InlineDocsViewer(cssPropName,cssPropDetails);inlineWidget.load(hostEditor);result.resolve(inlineWidget)}else{result.reject()}}).fail(function(){result.reject()});return result.promise()}else{return null}}EditorManager.registerInlineDocsProvider(inlineProvider);exports._getCSSDocs=getCSSDocs;exports._inlineProvider=inlineProvider});